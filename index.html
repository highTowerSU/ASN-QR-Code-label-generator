<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QR Code Label Generator for ASN in Paperless-ngx</title>
    <link rel="canonical" href="https://tobiasmaier.info/asn-qr-code-label-generator/" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <style>
      /* Neue Styles für die Spaltenüberschriften */
      .column-header {
        text-align: left;
        font-weight: bold;
        padding: 0 0 0.5rem 0;
        margin: 0 0 0.5rem 0;
        border-bottom: 1px solid #e5e7eb;
        font-size: 0.875rem;  /* text-sm */
      }

      .input-grid {
        display: grid;
        grid-template-columns: 2fr 1fr 1fr;  /* Parameter-Spalte breiter als Soll/Ist */
        gap: 0.75rem;
        align-items: center;
      }

      .input-grid .column-headers {
        display: contents;
      }

      .input-grid .input-row {
        display: contents;
      }

      @media print {
        @page {
          size: 210mm 297mm;
          margin: 0;
        }
        
        html, body {
          margin: 0;
          padding: 0;
          width: 210mm;
          height: 297mm;
        }

        .print-hidden {
          display: none !important;
        }

        .print-only {
          display: block !important;
          position: relative !important;
          margin: 0 !important;
          padding: 0 !important;
          width: 210mm;
          height: 297mm;
        }

        .print-only .page {
          position: absolute !important;
          margin: 0 !important;
          padding: 0 !important;
          top: 12.63mm !important;    /* Fester oberer Rand */
          left: 9.90mm !important;    /* Fester linker Rand */
          width: calc(210mm - 9.90mm - 8.36mm) !important;  /* Feste Breite */
          height: calc(297mm - 12.63mm - 13.87mm) !important;  /* Feste Höhe */
          transform: none !important;
          box-sizing: border-box !important;
        }

        .print-only .label {
          margin: 0 !important;
          padding: 0 !important;
          width: 25.61mm !important;
          height: 10.06mm !important;
        }

        .print-only .qr-code {
          width: 9mm;
          height: 9mm;
          margin-left: 0.5mm;
        }

        .print-only .text {
          flex: 1;
          font-size: var(--text-size, 11px);
          font-family: var(--text-font, Arial);
          font-weight: var(--text-weight, normal);
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
          text-align: left;
          padding-left: 1mm;
          max-width: 14mm;
          line-height: 1;
        }
      }

      .page {
        --mm-to-px: 3.779528;
        width: calc(210mm - var(--padding-left) - var(--padding-right));
        height: calc(297mm - var(--padding-top) - var(--padding-bottom));
        box-sizing: border-box;
        display: grid;
        grid-template-columns: repeat(7, 25.61mm);
        grid-template-rows: repeat(27, 10.06mm);
        gap: var(--gap-vertical, 0mm) var(--gap-horizontal, 2.63mm);
        justify-content: start;
        align-content: start;
        position: absolute;
        top: var(--padding-top);
        left: var(--padding-left);
        background-color: white;
        margin: 0;
        padding: 0;
      }
      .label {
        width: 25.61mm;
        height: 10.06mm;
        display: flex;
        align-items: center;
        justify-content: flex-start;
        border: var(--label-border, 0.1mm solid black);
        padding: 0mm;
        box-sizing: border-box;
        overflow: hidden;
        margin: 0;
        background-color: white;
      }
      .qr-code {
        width: 9mm;
        height: 9mm;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-left: 0.5mm;
      }
      .text {
        flex: 1;
        font-size: var(--text-size, 11px);
        font-family: var(--text-font, Arial);
        font-weight: var(--text-weight, normal);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        text-align: left;
        padding-left: 1mm;
        max-width: 14mm;
        line-height: 1;
      }
      
      /* Neue Styles für A4-Visualisierung */
      .page-preview {
        position: relative;
        margin: 20px auto;
        width: 210mm;
        height: 297mm;
        overflow: visible;
        background-color: white;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      
      .a4-border {
        position: absolute;
        top: 0;
        left: 0;
        width: 210mm;
        height: 297mm;
        border: 2px solid #000;
        pointer-events: none;
        box-sizing: border-box;
      }
      
      .padding-visualization {
        position: absolute;
        width: calc(210mm - var(--padding-left) - var(--padding-right));
        height: calc(297mm - var(--padding-top) - var(--padding-bottom));
        border: 2px dashed #ff0000;
        top: var(--padding-top);
        left: var(--padding-left);
        pointer-events: none;
        box-sizing: border-box;
      }
      
      /* Beschriftungen für Padding */
      .padding-label {
        position: absolute;
        background: rgba(255, 0, 0, 0.1);
        color: #ff0000;
        font-size: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10;
      }
      
      .padding-top {
        top: 0;
        left: var(--padding-left);
        width: calc(210mm - var(--padding-left) - var(--padding-right));
        height: var(--padding-top);
      }
      
      .padding-bottom {
        bottom: 0;
        left: var(--padding-left);
        width: calc(210mm - var(--padding-left) - var(--padding-right));
        height: var(--padding-bottom);
      }
      
      .padding-left {
        top: var(--padding-top);
        left: 0;
        width: var(--padding-left);
        height: calc(297mm - var(--padding-top) - var(--padding-bottom));
        writing-mode: vertical-rl;
        transform: rotate(180deg);
        display: flex;
        justify-content: center;
        align-items: center;
      }
      
      .padding-right {
        top: var(--padding-top);
        right: 0;
        width: var(--padding-right);
        height: calc(297mm - var(--padding-top) - var(--padding-bottom));
        writing-mode: vertical-rl;
        transform: rotate(180deg);
        display: flex;
        justify-content: center;
        align-items: center;
      }
      
      /* Container für die Vorschau */
      .preview-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-top: 2rem;
        margin-bottom: 2rem;
        position: relative;
        width: 100%;
        overflow-x: auto;
        padding: 20px;
      }
      
      .main-layout {
        max-width: 1200px;
        margin: 0 auto;
        padding: 1rem;
      }
      
      .form-container {
        width: 100%;
        max-width: 800px;
        margin: 0 auto;
      }

      /* Neue Styles für die Eingabefelder */
      .number-input {
        width: 100px !important;
        padding: 0.25rem 0.5rem !important;
        text-align: right;
      }

      .prefix-input {
        width: 100px !important;
        padding: 0.25rem 0.5rem !important;
      }

      .text-size-input {
        width: 100px !important;
        text-align: right;
      }

      .font-select {
        width: 140px !important;
      }

      .font-weight-select {
        width: 120px !important;
      }

      .checkbox-container {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .input-group {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
      }
      
      .input-group label {
        font-size: 0.875rem;  /* text-sm */
      }
      
      .input-group input {
        width: 100%;
        padding: 0.375rem;
      }
      
      .input-group input[type="number"] {
        -moz-appearance: textfield;
      }
      
      .input-group input[type="number"]::-webkit-inner-spin-button,
      .input-group input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
      
      /* Angepasste Styles für Abstände */
      .section-group {
        margin-bottom: 1rem; /* Reduziert von 1.5rem (mb-6) auf 1rem (mb-4) */
      }
      
      .section-title {
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 0.5rem; /* Reduziert von 0.75rem (mb-3) auf 0.5rem (mb-2) */
      }
      
      .input-grid {
        display: grid;
        gap: 0.75rem; /* Reduziert von 1.25rem (gap-5) auf 0.75rem (gap-3) */
      }
      
      .input-grid-4 {
        grid-template-columns: repeat(2, 1fr);
      }
      
      @media (min-width: 768px) {
        .input-grid-4 {
          grid-template-columns: repeat(4, 1fr);
        }
      }
      
      .input-grid-2 {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .action-buttons {
        margin-top: 1rem;
        display: flex;
        gap: 0.75rem;
      }
      
      .input-grid-5 {
        grid-template-columns: repeat(2, 1fr);
      }
      
      @media (min-width: 768px) {
        .input-grid-5 {
          grid-template-columns: repeat(5, 1fr);
        }
      }
      
      /* Optimierte Styles für kompakteres Layout */
      .section-group {
        margin-bottom: 0.75rem;
        padding: 0.5rem;
        border: 1px solid #e5e7eb;
        border-radius: 0.375rem;
      }
      
      .section-title {
        font-size: 0.875rem;
        font-weight: 600;
        margin-bottom: 0.375rem;
        color: #374151;
      }
      
      .input-grid {
        display: grid;
        gap: 0.5rem;
      }
      
      .input-grid-5 {
        grid-template-columns: repeat(2, 1fr);
      }
      
      @media (min-width: 768px) {
        .input-grid-5 {
          grid-template-columns: auto auto auto 1fr 1fr;
          align-items: center;
        }
      }
      
      .input-grid-4 {
        grid-template-columns: repeat(2, 1fr);
      }
      
      @media (min-width: 768px) {
        .input-grid-4 {
          grid-template-columns: repeat(4, 1fr);
        }
      }
      
      .input-grid-2 {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .input-group {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
      }
      
      .input-group label {
        font-size: 0.75rem;
        color: #4b5563;
      }
      
      .number-input {
        width: 60px !important;
        padding: 0.25rem 0.5rem !important;
        text-align: center;
      }
      
      .prefix-input {
        width: 80px !important;
        padding: 0.25rem 0.5rem !important;
      }
      
      .checkbox-container {
        display: flex;
        align-items: center;
        gap: 0.375rem;
        font-size: 0.875rem;
      }
      
      .checkbox-container input[type="checkbox"] {
        width: 1rem;
        height: 1rem;
      }
      
      .action-buttons {
        margin-top: 0.75rem;
        display: flex;
        gap: 0.5rem;
      }
      
      .form-container {
        max-width: 700px;
        margin: 0 auto;
        padding: 1rem;
      }
      
      /* Verbesserte Button-Styles */
      .btn {
        padding: 0.375rem 0.75rem;
        border-radius: 0.25rem;
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.2s;
      }
      
      .btn-primary {
        background-color: #2563eb;
        color: white;
      }
      
      .btn-primary:hover {
        background-color: #1d4ed8;
      }
      
      .btn-success {
        background-color: #059669;
        color: white;
      }
      
      .btn-success:hover {
        background-color: #047857;
      }

      @media screen {
        .print-only {
          display: none;
        }
      }
    </style>
  </head>
  <body x-data="qrCodeApp()" x-init="generateLabels()">
    <div class="main-layout">
      <div class="form-container">
        <div class="container mx-auto print-hidden">
          <div class="flex justify-between items-center mb-3">
            <h1 class="text-xl font-bold">QR Code Label Generator</h1>
            <span class="text-sm text-gray-600">v0.908</span>
          </div>
          <form @submit.prevent="generateLabels()">
            <!-- QR Code Configuration -->
            <div class="section-group">
              <h2 class="section-title">QR Code Settings</h2>
              <div class="input-grid input-grid-5">
                <div class="input-group">
                  <label for="startNumber">Start Number</label>
                  <input type="number" id="startNumber" x-model="startNumber" required min="1" step="1" class="border number-input" />
                </div>
                <div class="input-group">
                  <label for="prefix">ASN Prefix</label>
                  <input type="text" id="prefix" x-model="prefix" required class="border prefix-input" placeholder="ASN" />
                </div>
                <div class="input-group">
                  <label for="leadingZeros">Leading Zeros</label>
                  <input type="number" id="leadingZeros" x-model="leadingZeros" required min="0" max="10" step="1" class="border number-input" />
                </div>
                <div class="checkbox-container">
                  <input type="checkbox" id="showPrefix" x-model="showPrefix" class="border" />
                  <label for="showPrefix">Display Prefix</label>
                </div>
                <div class="checkbox-container">
                  <input type="checkbox" id="showBorder" x-model="showBorder" class="border" />
                  <label for="showBorder">Show Label Borders</label>
                </div>
              </div>
            </div>

            <!-- Page Margin Settings -->
            <div class="section-group">
              <h2 class="section-title">Seitenränder und Skalierung (mm)</h2>
              <div class="input-grid">
                <div class="column-headers">
                  <div class="column-header">Parameter</div>
                  <div class="column-header">Soll (mm)</div>
                  <div class="column-header">Ist (mm)</div>
                </div>

                <div class="input-row">
                  <div class="input-group">
                    <label>Rand oben</label>
                  </div>
                  <div class="input-group">
                    <input type="number" x-model="targetPaddingTop" class="border number-input" min="0" step="0.01" />
                  </div>
                  <div class="input-group">
                    <input type="number" x-model="actualPaddingTop" class="border number-input" min="0" step="0.01" @input="calculatePaddingScaling()" />
                  </div>
                </div>

                <div class="input-row">
                  <div class="input-group">
                    <label>Rand unten</label>
                  </div>
                  <div class="input-group">
                    <input type="number" x-model="targetPaddingBottom" class="border number-input" min="0" step="0.01" />
                  </div>
                  <div class="input-group">
                    <input type="number" x-model="actualPaddingBottom" class="border number-input" min="0" step="0.01" @input="calculatePaddingScaling()" />
                  </div>
                </div>

                <div class="input-row">
                  <div class="input-group">
                    <label>Rand links</label>
                  </div>
                  <div class="input-group">
                    <input type="number" x-model="targetPaddingLeft" class="border number-input" min="0" step="0.01" />
                  </div>
                  <div class="input-group">
                    <input type="number" x-model="actualPaddingLeft" class="border number-input" min="0" step="0.01" @input="calculatePaddingScaling()" />
                  </div>
                </div>

                <div class="input-row">
                  <div class="input-group">
                    <label>Rand rechts</label>
                  </div>
                  <div class="input-group">
                    <input type="number" x-model="targetPaddingRight" class="border number-input" min="0" step="0.01" />
                  </div>
                  <div class="input-group">
                    <input type="number" x-model="actualPaddingRight" class="border number-input" min="0" step="0.01" @input="calculatePaddingScaling()" />
                  </div>
                </div>
              </div>

              <div class="mt-4 p-2 bg-gray-100 rounded">
                <div class="flex justify-between items-center">
                  <span class="font-bold text-sm">Berechneter Skalierungsfaktor für Ränder:</span>
                  <span x-text="'Horizontal: ' + (paddingScalingX || '1.000') + ' / Vertikal: ' + (paddingScalingY || '1.000')" class="font-mono text-xs"></span>
                </div>
              </div>
            </div>

            <!-- Label Spacing Settings -->
            <div class="section-group">
              <h2 class="section-title">Etikettenmaße und Skalierung</h2>
              <div class="input-grid">
                <div class="column-headers">
                  <div class="column-header">Parameter</div>
                  <div class="column-header">Soll (mm)</div>
                  <div class="column-header">Ist (mm)</div>
                </div>

                <div class="input-row">
                  <div class="input-group">
                    <label>Etikettenbreite</label>
                  </div>
                  <div class="input-group">
                    <input type="number" x-model="targetWidth" class="border number-input" min="0" step="0.01" />
                  </div>
                  <div class="input-group">
                    <input type="number" x-model="actualWidth" class="border number-input" min="0" step="0.01" @input="calculateScaling()" />
                  </div>
                </div>

                <div class="input-row">
                  <div class="input-group">
                    <label>Etikettenhöhe</label>
                  </div>
                  <div class="input-group">
                    <input type="number" x-model="targetHeight" class="border number-input" min="0" step="0.01" />
                  </div>
                  <div class="input-group">
                    <input type="number" x-model="actualHeight" class="border number-input" min="0" step="0.01" @input="calculateScaling()" />
                  </div>
                </div>

                <div class="input-row">
                  <div class="input-group">
                    <label>Horizontaler Abstand</label>
                  </div>
                  <div class="input-group">
                    <input type="number" x-model="targetGapHorizontal" class="border number-input" min="0" step="0.01" />
                  </div>
                  <div class="input-group">
                    <input type="number" x-model="actualGapHorizontal" class="border number-input" min="0" step="0.01" @input="calculateScaling()" />
                  </div>
                </div>

                <div class="input-row">
                  <div class="input-group">
                    <label>Vertikaler Abstand</label>
                  </div>
                  <div class="input-group">
                    <input type="number" x-model="targetGapVertical" class="border number-input" min="0" step="0.01" />
                  </div>
                  <div class="input-group">
                    <input type="number" x-model="actualGapVertical" class="border number-input" min="0" step="0.01" @input="calculateScaling()" />
                  </div>
                </div>
              </div>

              <div class="mt-4 p-2 bg-gray-100 rounded">
                <div class="flex justify-between items-center">
                  <span class="font-bold text-sm">Berechneter Skalierungsfaktor:</span>
                  <span x-text="'Horizontal: ' + (scalingFactorX || '1.000') + ' / Vertikal: ' + (scalingFactorY || '1.000')" class="font-mono text-xs"></span>
                </div>
              </div>
            </div>

            <!-- Label Count Settings -->
            <div class="section-group">
              <h2 class="section-title">Etikettenanzahl</h2>
              <div class="input-grid">
                <div class="column-headers">
                  <div class="column-header">Parameter</div>
                  <div class="column-header">Wert</div>
                  <div class="column-header"></div>
                </div>

                <div class="input-row">
                  <div class="input-group">
                    <label>Etiketten pro Zeile</label>
                  </div>
                  <div class="input-group">
                    <input type="number" x-model="labelsPerRow" class="border number-input" min="1" step="1" @input="generateLabels()" />
                  </div>
                  <div class="input-group">
                  </div>
                </div>

                <div class="input-row">
                  <div class="input-group">
                    <label>Anzahl Zeilen</label>
                  </div>
                  <div class="input-group">
                    <input type="number" x-model="maxRows" class="border number-input" min="1" step="1" @input="generateLabels()" />
                  </div>
                  <div class="input-group">
                  </div>
                </div>
              </div>
            </div>

            <!-- Neue Sektion für Textformatierung -->
            <div class="section-group">
              <h3 class="section-title">Textformatierung</h3>
              <div class="input-grid input-grid-4">
                <div class="input-group">
                  <label for="text-size" class="text-sm font-medium text-gray-700">Schriftgröße (px)</label>
                  <input type="number" id="text-size" x-model="textSize" class="text-size-input mt-1 block rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" min="6" max="20" step="0.5">
                </div>
                <div class="input-group">
                  <label for="text-font" class="text-sm font-medium text-gray-700">Schriftart</label>
                  <select id="text-font" x-model="textFont" class="font-select mt-1 block rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    <option value="Arial">Arial</option>
                    <option value="Helvetica">Helvetica</option>
                    <option value="Times New Roman">Times New Roman</option>
                    <option value="Courier New">Courier New</option>
                    <option value="Verdana">Verdana</option>
                    <option value="Tahoma">Tahoma</option>
                  </select>
                </div>
                <div class="input-group">
                  <label for="text-weight" class="text-sm font-medium text-gray-700">Schriftstärke</label>
                  <select id="text-weight" x-model="textWeight" class="font-weight-select mt-1 block rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    <option value="normal">Normal</option>
                    <option value="bold">Fett</option>
                    <option value="lighter">Leicht</option>
                    <option value="500">Medium</option>
                    <option value="600">Semi-Bold</option>
                    <option value="800">Extra-Bold</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
              <button @click.prevent="generateLabels()" class="btn btn-primary">
                Update Labels
              </button>
              <button @click.prevent="printLabels()" class="btn btn-success">
                Print Labels
              </button>
            </div>
          </form>
        </div>
      </div>
      
      <div class="preview-container print-hidden">
        <div class="page-preview">
          <div class="a4-border"></div>
          <div class="padding-visualization"></div>
          <div class="padding-label padding-top" x-text="paddingTop + 'mm'"></div>
          <div class="padding-label padding-bottom" x-text="paddingBottom + 'mm'"></div>
          <div class="padding-label padding-left" x-text="paddingLeft + 'mm'"></div>
          <div class="padding-label padding-right" x-text="paddingRight + 'mm'"></div>
          <div class="page" id="label-container"></div>
        </div>
      </div>

      <!-- Separate print version -->
      <div class="print-only">
        <div class="page" id="print-label-container"></div>
      </div>
    </div>

    <script>
      function qrCodeApp() {
        return {
          startNumber: 1,
          prefix: "ASN",
          leadingZeros: 4,
          showPrefix: true,
          showBorder: true,
          paddingTop: 12.63,    // Korrigierter oberer Rand (13.33mm - 0.7mm)
          paddingRight: 8.36,   // Gemessener rechter Rand
          paddingBottom: 13.87, // Gemessener unterer Rand
          paddingLeft: 9.90,    // Korrigierter linker Rand (8.42mm + 1.48mm)
          gapVertical: 0,       // Gemessener vertikaler Abstand
          gapHorizontal: 2.63,  // Gemessener horizontaler Abstand
          labels: [],
          textSize: '12',
          textFont: 'Tahoma',
          textWeight: 'normal',
          // Neue Variablen für Soll- und Ist-Werte
          targetWidth: 25.61,
          targetHeight: 10.06,
          targetGapHorizontal: 2.63,
          targetGapVertical: 0,
          actualWidth: 25.61,      // Mit Soll-Wert initialisiert
          actualHeight: 10.06,     // Mit Soll-Wert initialisiert
          actualGapHorizontal: 2.63, // Mit Soll-Wert initialisiert
          actualGapVertical: 0,    // Mit Soll-Wert initialisiert
          scalingFactorX: null,
          scalingFactorY: null,
          // Neue Variablen für Soll- und Ist-Werte der Ränder
          targetPaddingTop: 12.63,
          targetPaddingBottom: 13.87,
          targetPaddingLeft: 9.90,
          targetPaddingRight: 8.36,
          actualPaddingTop: 12.63,    // Mit Soll-Wert initialisiert
          actualPaddingBottom: 13.87, // Mit Soll-Wert initialisiert
          actualPaddingLeft: 9.90,    // Mit Soll-Wert initialisiert
          actualPaddingRight: 8.36,   // Mit Soll-Wert initialisiert
          paddingScalingX: null,
          paddingScalingY: null,
          // Neue Variablen für die Etikettenanzahl
          labelsPerRow: 7,
          maxRows: 27,

          calculateScaling() {
            if (this.actualWidth && this.targetWidth) {
              const widthScaling = parseFloat(this.targetWidth) / parseFloat(this.actualWidth);
              this.scalingFactorX = widthScaling.toFixed(3);
              // Wende die Skalierung sofort auf die horizontalen Abstände an
              if (this.actualGapHorizontal && this.targetGapHorizontal) {
                this.gapHorizontal = parseFloat(this.targetGapHorizontal);
              }
            }
            if (this.actualHeight && this.targetHeight) {
              const heightScaling = parseFloat(this.targetHeight) / parseFloat(this.actualHeight);
              this.scalingFactorY = heightScaling.toFixed(3);
              // Wende die Skalierung sofort auf die vertikalen Abstände an
              if (this.actualGapVertical && this.targetGapVertical) {
                this.gapVertical = parseFloat(this.targetGapVertical);
              }
            }
            this.renderLabels();
          },

          applyScaling() {
            if (this.scalingFactorX && this.scalingFactorY) {
              // Wende Skalierung auf die Abstände an
              this.gapHorizontal = this.targetGapHorizontal;
              this.gapVertical = this.targetGapVertical;
              
              // Generiere Labels neu
              this.generateLabels();
            }
          },

          calculatePaddingScaling() {
            if (this.actualPaddingLeft && this.targetPaddingLeft && this.actualPaddingRight && this.targetPaddingRight) {
              const leftScaling = parseFloat(this.targetPaddingLeft) / parseFloat(this.actualPaddingLeft);
              const rightScaling = parseFloat(this.targetPaddingRight) / parseFloat(this.actualPaddingRight);
              const horizontalScaling = (leftScaling + rightScaling) / 2;
              this.paddingScalingX = horizontalScaling.toFixed(3);
              // Wende die Skalierung sofort auf die horizontalen Ränder an
              this.paddingLeft = parseFloat(this.targetPaddingLeft);
              this.paddingRight = parseFloat(this.targetPaddingRight);
            }
            if (this.actualPaddingTop && this.targetPaddingTop && this.actualPaddingBottom && this.targetPaddingBottom) {
              const topScaling = parseFloat(this.targetPaddingTop) / parseFloat(this.actualPaddingTop);
              const bottomScaling = parseFloat(this.targetPaddingBottom) / parseFloat(this.actualPaddingBottom);
              const verticalScaling = (topScaling + bottomScaling) / 2;
              this.paddingScalingY = verticalScaling.toFixed(3);
              // Wende die Skalierung sofort auf die vertikalen Ränder an
              this.paddingTop = parseFloat(this.targetPaddingTop);
              this.paddingBottom = parseFloat(this.targetPaddingBottom);
            }
            this.renderLabels();
          },

          applyPaddingScaling() {
            if (this.paddingScalingX && this.paddingScalingY) {
              // Wende Skalierung auf die Seitenränder an
              this.paddingLeft = this.targetPaddingLeft;
              this.paddingRight = this.targetPaddingRight;
              this.paddingTop = this.targetPaddingTop;
              this.paddingBottom = this.targetPaddingBottom;
              
              // Generiere Labels neu
              this.generateLabels();
            }
          },

          generateLabels() {
            this.labels = [];
            let totalLabels = this.labelsPerRow * this.maxRows;
            let startNumberInt = parseInt(this.startNumber, 10);
            for (let i = 0; i < totalLabels; i++) {
              let number = startNumberInt + i;
              let text = this.showPrefix ? 
                this.prefix + number.toString().padStart(this.leadingZeros, "0") : 
                number.toString().padStart(this.leadingZeros, "0");
              let qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=${encodeURIComponent(text)}`;
              this.labels.push({ qrCodeUrl, text });
            }
            this.renderLabels();
          },

          renderLabels() {
            let container = document.getElementById("label-container");
            let printContainer = document.getElementById("print-label-container");
            container.innerHTML = "";
            printContainer.innerHTML = "";
            
            // Setze die CSS-Variablen für das Layout
            const root = document.documentElement;
            root.style.setProperty('--padding-top', `${this.paddingTop}mm`);
            root.style.setProperty('--padding-right', `${this.paddingRight}mm`);
            root.style.setProperty('--padding-bottom', `${this.paddingBottom}mm`);
            root.style.setProperty('--padding-left', `${this.paddingLeft}mm`);
            root.style.setProperty('--gap-vertical', `${this.gapVertical}mm`);
            root.style.setProperty('--gap-horizontal', `${this.gapHorizontal}mm`);
            root.style.setProperty('--text-size', `${this.textSize}px`);
            root.style.setProperty('--text-font', this.textFont);
            root.style.setProperty('--text-weight', this.textWeight);
            
            // Setze die Grid-Templates für beide Container
            const columnsStyle = `repeat(${this.labelsPerRow}, 25.61mm)`;
            const rowsStyle = `repeat(${this.maxRows}, 10.06mm)`;
            container.style.gridTemplateColumns = columnsStyle;
            container.style.gridTemplateRows = rowsStyle;
            printContainer.style.gridTemplateColumns = columnsStyle;
            printContainer.style.gridTemplateRows = rowsStyle;
            
            // Setze die Rahmen für beide Container
            const borderStyle = this.showBorder ? '0.1mm solid black' : 'none';
            container.style.setProperty('--label-border', borderStyle);
            printContainer.style.setProperty('--label-border', borderStyle);
            
            this.labels.forEach((label) => {
              // Preview version
              let labelDiv = document.createElement("div");
              labelDiv.classList.add("label");
              let qrImg = document.createElement("img");
              qrImg.src = label.qrCodeUrl;
              qrImg.classList.add("qr-code");
              let textDiv = document.createElement("div");
              textDiv.classList.add("text");
              textDiv.innerText = label.text;
              labelDiv.appendChild(qrImg);
              labelDiv.appendChild(textDiv);
              container.appendChild(labelDiv);

              // Print version
              let printLabelDiv = labelDiv.cloneNode(true);
              printContainer.appendChild(printLabelDiv);
            });
          },

          printLabels() {
            // Speichere aktuelle Scroll-Position
            const scrollPos = window.scrollY;

            // Setze optimale Druckeinstellungen
            const style = document.createElement('style');
            style.textContent = `
              @page { size: 210mm 297mm; margin: 0; }
              @media print {
                html, body {
                  margin: 0 !important;
                  padding: 0 !important;
                }
                .print-only .page {
                  margin: 0 !important;
                  padding: 0 !important;
                  top: var(--padding-top) !important;
                  left: var(--padding-left) !important;
                  transform: none !important;
                }
              }
            `;
            document.head.appendChild(style);

            // Warte auf Bilder
            Promise.all(
              Array.from(document.images)
                .filter(img => !img.complete)
                .map(img => new Promise(resolve => {
                  img.onload = img.onerror = resolve;
                }))
            ).then(() => {
              window.print();
              
              // Cleanup
              document.head.removeChild(style);
              window.scrollTo(0, scrollPos);
            });
          },
        };
      }
    </script>
  </body>
</html>
